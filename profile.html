<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Update Profile</title>
  <style>
    body {font-family: 'Segoe UI', Roboto, Arial; max-width: 900px; margin: 40px auto; padding: 20px; background: #f4f6f8; color: #333;}
    h1 {text-align: center; font-size: 26px; margin-bottom: 20px; color: #0b78e3;}
    form {background: #fff; padding: 24px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: grid; gap: 16px;}
    fieldset {border: none; padding: 0;}
    legend {font-weight: 600; color: #0b78e3; margin-bottom: 8px;}
    .row {display: flex; flex-wrap: wrap; gap: 16px;}
    .col {flex: 1; min-width: 220px;}
    label {display: block; font-size: 14px; margin-bottom: 6px; color: #555;}
    input[type="text"], input[type="email"], input[type="date"], select, textarea, input[type="file"] {
      width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; transition: 0.3s;
    }
    input:focus, textarea:focus { border-color: #0b78e3; outline: none; box-shadow: 0 0 0 3px rgba(11,120,227,0.1);}
    .files {display: flex; gap: 16px; flex-wrap: wrap;}
    button {padding: 12px 18px; border-radius: 8px; border: none; background: #0b78e3; color: white; cursor: pointer; font-size: 15px; transition: 0.3s;}
    button:hover {background: #095bb7;}
    button:disabled {background: #ccc; cursor: not-allowed;}
    pre {background: #111; color: #e6e6e6; padding: 12px; border-radius: 6px; overflow-x: auto;}
  </style>
</head>
<body>
  <h1>Update Profile</h1>
  <form id="profileForm">
    <!-- Personal Details -->
    <fieldset>
      <legend>Personal Details</legend>
      <div class="row">
        <div class="col"><label>Full Name<input id="fullName" type="text" value="Deepanshu Kandpal" /></label></div>
        <div class="col"><label>Father Name<input id="fatherName" type="text" value="Rajesh Kandpal" /></label></div>
      </div>
      <div class="row">
        <div class="col"><label>Date of Birth<input id="dob" type="date" value="1998-05-14" /></label></div>
        <div class="col"><label>Gender<input id="gender" type="text" value="Male" /></label></div>
      </div>
      <div class="row">
        <div class="col"><label>Email<input id="email" type="email" value="deepanshu@example.com" /></label></div>
        <div class="col"><label>Contact Number<input id="contactNumber" type="text" value="9876543210" /></label></div>
      </div>
      <label>Present Status<input id="presentStatus" type="text" value="Doctor" /></label>
      <label>Council Name<input id="councilName" type="text" value="Uttarakhand Medical Council" /></label>

      <fieldset>
        <legend>Centers</legend>
        <div class="row">
          <div class="col"><label>Center 1<input id="center1" type="text" value="Dehradun" /></label></div>
          <div class="col"><label>Center 2<input id="center2" type="text" value="Delhi" /></label></div>
        </div>
      </fieldset>

      <fieldset>
        <legend>Address</legend>
        <div class="row">
          <div class="col"><label>House<input id="house" type="text" value="22/A" /></label></div>
          <div class="col"><label>Street<input id="street" type="text" value="Mall Road" /></label></div>
        </div>
        <div class="row">
          <div class="col"><label>City<input id="city" type="text" value="Almora" /></label></div>
          <div class="col"><label>District<input id="district" type="text" value="Almora" /></label></div>
        </div>
        <div class="row">
          <div class="col"><label>State<input id="state" type="text" value="Uttarakhand" /></label></div>
          <div class="col"><label>Pincode<input id="pincode" type="text" value="263601" /></label></div>
        </div>
      </fieldset>

      <label>Registration Certificate<input id="file_registrationCertificate" name="registrationCertificate" type="file" accept="image/*,application/pdf" /></label>
    </fieldset>

    <!-- Education -->
    <fieldset>
      <legend>Education</legend>
      <label>MBBS - Year<input id="mbbsYear" type="text" value="2020" /></label>
      <label>MBBS - Month<input id="mbbsMonth" type="text" value="June" /></label>
      <label>MBBS - College<input id="mbbsCollege" type="text" value="AIIMS Rishikesh" /></label>
      <label>MBBS - University<input id="mbbsUniversity" type="text" value="AIIMS University" /></label>
      <label>MBBS - Place<input id="mbbsPlace" type="text" value="Rishikesh" /></label>
      <label>MBBS - RegNo<input id="mbbsRegNo" type="text" value="MBBS2020AIIMS" /></label>
      <label>MBBS Certificate<input id="file_mbbsCertificate" name="mbbsCertificate" type="file" accept="image/*,application/pdf" /></label>

      <hr>

      <label>PG - Year<input id="pgYear" type="text" value="2023" /></label>
      <label>PG - Month<input id="pgMonth" type="text" value="June" /></label>
      <label>PG - College<input id="pgCollege" type="text" value="AIIMS Delhi" /></label>
      <label>PG - University<input id="pgUniversity" type="text" value="AIIMS University" /></label>
      <label>PG - Place<input id="pgPlace" type="text" value="Delhi" /></label>
      <label>PG - RegNo<input id="pgRegNo" type="text" value="PG2023AIIMS" /></label>
      <label>PG Certificate<input id="file_pgCertificate" name="pgCertificate" type="file" accept="image/*,application/pdf" /></label>
    </fieldset>

    <!-- Other Documents -->
    <fieldset>
      <legend>Other Documents</legend>
      <div class="files">
        <div><label>Photo<input id="file_photo" name="photo" type="file" accept="image/*" /></label></div>
        <div><label>Signature<input id="file_signature" name="signature" type="file" accept="image/*" /></label></div>
        <div><label>ID Proof<input id="file_id_proof" name="id_proof" type="file" accept="application/pdf,image/*" /></label></div>
        <div><label>Education File<input id="file_education" name="education" type="file" accept="application/pdf,image/*" /></label></div>
        <div><label>Address Proof<input id="file_address" name="address" type="file" accept="application/pdf,image/*" /></label></div>
      </div>
    </fieldset>

    <div style="text-align:center">
      <button id="submitBtn" type="submit">Submit</button>
    </div>
  </form>

  <h3>Server Response</h3>
  <pre id="result">No request sent yet.</pre>

  <script>
    const form = document.getElementById('profileForm');
    const result = document.getElementById('result');
    const submitBtn = document.getElementById('submitBtn');
    const apiUrl = 'http://localhost:5000/api/users/auth/update-profile/68efcd57406a4a62ceb8f493';

    function buildApplicationObject() {
      return {
        fullName: fullName.value,
        fatherName: fatherName.value,
        dob: dob.value || null,
        gender: gender.value,
        email: email.value,
        contactNumber: contactNumber.value,
        presentStatus: presentStatus.value,
        councilName: councilName.value,
        centers: { center1: center1.value, center2: center2.value },
        address: { house: house.value, street: street.value, city: city.value, district: district.value, state: state.value, pincode: pincode.value }
      };
    }

    function buildEducationObject() {
      return {
        mbbs: {
          year: mbbsYear.value, month: mbbsMonth.value, college: mbbsCollege.value,
          university: mbbsUniversity.value, place: mbbsPlace.value, regNo: mbbsRegNo.value
        },
        pg: {
          year: pgYear.value, month: pgMonth.value, college: pgCollege.value,
          university: pgUniversity.value, place: pgPlace.value, regNo: pgRegNo.value
        },
        others: []
      };
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      result.textContent = 'Sending request...';
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';

      try {
        const formData = new FormData();
        formData.append('application', JSON.stringify(buildApplicationObject()));
        formData.append('education', JSON.stringify(buildEducationObject()));

        // Append files as arrays to match multer's expectation
        [
          'photo','signature','id_proof','education','address',
          'registrationCertificate','mbbsCertificate','pgCertificate'
        ].forEach(name => {
          const el = document.getElementById('file_' + name);
          if (el && el.files.length) {
            for (let i = 0; i < el.files.length; i++) {
              formData.append(name, el.files[i]);
            }
          }
        });

        const resp = await fetch(apiUrl, { method: 'PUT', body: formData });
        const text = await resp.text();
        try { result.textContent = JSON.stringify(JSON.parse(text), null, 2); }
        catch { result.textContent = 'HTTP ' + resp.status + '\n' + text; }
      } catch (err) {
        result.textContent = 'Error: ' + err.message;
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit';
      }
    });
  </script>
</body>
</html>
